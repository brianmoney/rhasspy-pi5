
services:
  mosquitto:
    image: eclipse-mosquitto:2
    container_name: mosquitto
    restart: unless-stopped
    ports:
      - "1883:1883"
    volumes:
      - ./mosquitto/config:/mosquitto/config
      - ./mosquitto/data:/mosquitto/data
      - ./mosquitto/log:/mosquitto/log

  rhasspy:
    image: rhasspy/rhasspy
    container_name: rhasspy
    restart: unless-stopped
    depends_on:
      - mosquitto
    environment:
      - PULSE_SERVER=unix:/run/user/1000/pulse/native
    volumes:
      - /run/user/1000/pulse:/run/user/1000/pulse
      - ~/.config/pulse/cookie:/home/rhasspy/.config/pulse/cookie
      - ./profiles:/profiles
    devices:
      - "/dev/snd:/dev/snd"
    command: >
      --user-profiles /profiles
      --profile en
      --mqtt-host mosquitto
    ports:
      - "12101:12101"  # Rhasspy Web UI
    user: "1000:1000"
    tty: true

